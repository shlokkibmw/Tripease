<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home | Travel Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <style>
    :root {
      --primary: #4a6fa5;
      --secondary: #166088;
      --accent: #4fc3f7;
      --light: #f8f9fa;
      --dark: #343a40;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
    }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background:#f5f5f5; color:#333; display:flex; flex-direction:column; height:100vh; }
    header { display:flex; align-items:center; justify-content:space-between; background:white; padding:15px 20px; box-shadow:0 2px 5px rgba(0,0,0,0.1); z-index:98; }
    #menu-toggle { background:none; border:none; font-size:20px; cursor:pointer; color:var(--secondary); }
    header h1 { margin:0; font-size:20px; color:var(--secondary); }
    nav a { color:var(--secondary); text-decoration:none; display:flex; align-items:center; gap:5px; }
    /* Sidebar */
    .sidebar { width:250px; background:#fff; position:fixed; top:0; left:0; height:100vh; box-shadow:2px 0 10px rgba(0,0,0,0.1); transform:translateX(-100%); transition:transform 0.3s ease; z-index:99; padding-top:60px; }
    .sidebar.show { transform:translateX(0); }
    .sidebar-header { padding:20px; text-align:center; border-bottom:1px solid #eee; }
    .sidebar-header img { width:80px; height:80px; border-radius:50%; object-fit:cover; margin-bottom:10px; }
    .sidebar-header h3 { margin:5px 0; }
    .sidebar-header p { margin:0; color:var(--warning); font-size:14px; }
    .sidebar ul { list-style:none; padding:0; margin:0; }
    .sidebar li a { display:flex; align-items:center; padding:12px 20px; color:#555; text-decoration:none; transition:0.3s; }
    .sidebar li a:hover, .sidebar li a.active { background:rgba(74,111,165,0.1); color:var(--primary); }
    .sidebar li a i { margin-right:10px; width:20px; text-align:center; }
    /* Layout */
    .main-content { display:flex; flex:1; overflow:hidden; }
    .content-area { flex:1; display:flex; flex-direction:column; overflow:hidden; }
    .container { padding:20px; display:flex; flex-direction:column; overflow:hidden; flex:1; }
    /* Map Styles */
    .map-container { position:relative; flex:1 1 0; min-height:360px; border-radius:8px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.1); margin-bottom:20px; display:flex; }
    #map { width:100%; height:100%; }
    .map-overlay { position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.9); padding:10px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:1; }
    .map-controls { position:absolute; top:10px; right:10px; display:flex; flex-direction:column; gap:10px; z-index:2; }
    .map-control-btn { width:32px; height:32px; border-radius:4px; background:white; border:none; box-shadow:0 0 5px rgba(0,0,0,0.2); cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .map-legend { position:absolute; bottom:20px; left:10px; background:rgba(255,255,255,0.9); padding:10px; border-radius:5px; box-shadow:0 0 5px rgba(0,0,0,0.2); z-index:2; }
    .legend-item { display:flex; align-items:center; margin-bottom:5px; }
    .legend-color { width:15px; height:15px; border-radius:50%; margin-right:8px; display:inline-block; }
    .map-loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); z-index:10; text-align:center; color:var(--primary); }
    .spinner { border:4px solid rgba(0,0,0,0.1); border-left:4px solid var(--primary); border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:0 auto 15px; }
    @keyframes spin { 0% { transform:rotate(0deg);} 100%{ transform:rotate(360deg);} }
    /* Chatbot */
    .chatbot-container { width:25%; background:white; box-shadow:-2px 0 10px rgba(0,0,0,0.1); display:flex; flex-direction:column; border-left:1px solid #ddd; }
    .chatbot-header { font-weight:bold; font-size:18px; padding:15px; border-bottom:1px solid #ccc; background:var(--primary); color:white; }
    .chat-messages { flex-grow:1; overflow-y:auto; padding:15px; background:#f9f9f9; }
    .chat-message { margin-bottom:10px; padding:8px 12px; border-radius:15px; max-width:80%; }
    .chat-message.user { background:var(--primary); color:white; margin-left:auto; text-align:right; }
    .chat-message.bot { background:#e9ecef; color:#333; text-align:left; }
    .chat-form { display:flex; padding:15px; border-top:1px solid #ddd; }
    .chat-input { flex-grow:1; padding:10px; border:1px solid #ccc; border-radius:20px; outline:none; }
    .chat-send { padding:10px 15px; margin-left:10px; border:none; background:var(--primary); color:white; border-radius:20px; cursor:pointer; }
    /* Quick action buttons */
    .quick-actions { display:flex; flex-wrap:wrap; gap:8px; padding:10px 15px; border-bottom:1px solid #eee; background:#f5f7fa; }
    .quick-action-btn { background:white; border:1px solid #ddd; border-radius:20px; padding:6px 12px; font-size:12px; cursor:pointer; transition:all 0.2s; }
    .quick-action-btn:hover { background:var(--primary); color:white; }
    /* Itinerary styling */
    .itinerary { background:white; border-radius:8px; padding:15px; margin-top:10px; border-left:4px solid var(--primary); }
    .itinerary h4 { margin-top:0; color:var(--primary); }
    .itinerary-day { margin-bottom:15px; }
    .itinerary-day h5 { margin:0 0 8px 0; color:var(--secondary); }
    .itinerary-activity { display:flex; margin-bottom:5px; }
    .activity-time { font-weight:bold; margin-right:10px; min-width:70px; }
    .activity-desc { flex:1; }
  </style>
</head>
<body>
  <header>
    <button id="menu-toggle">&#9776;</button>
    <h1>Tour & Travel Dashboard</h1>
    <nav>
      <a id="logout-btn" href="login.html"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </header>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar" aria-hidden="true">
    <div class="sidebar-header">
      <img src="harsh.jpg" alt="User Profile" class="profile-img">
      <h3>Harsh Pandey</h3>
    </div>
    <ul>
      <li><a href="home.html"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
      <li><a href="mytrip.html"><i class="fas fa-suitcase"></i> My Trips</a></li>
      <li><a href="heritage.html"><i class="fas fa-landmark"></i> Heritage Cloud</a></li>
      <li><a href="help.html"><i class="fas fa-question-circle"></i> Help</a></li>
      <li><a href="setting.html"><i class="fas fa-cog"></i> Settings</a></li>
    </ul>
  </div>

  <div class="main-content">
    <div class="content-area">
      <div class="map-container">
        <div id="map">
          <div class="map-loading">
            <div class="spinner"></div>
            <p>Loading map...</p>
          </div>
        </div>
        <div class="map-overlay">
          <h4>Explore using TripEase</h4>
          <p>Click on markers to view details</p>
        </div>
        <div class="map-controls">
          <button class="map-control-btn" id="zoom-in"><i class="fas fa-plus"></i></button>
          <button class="map-control-btn" id="zoom-out"><i class="fas fa-minus"></i></button>
          <button class="map-control-btn" id="reset-view"><i class="fas fa-globe"></i></button>
        </div>
        <div class="map-legend">
          <h4>Destinations</h4>
          <div class="legend-item"><span class="legend-color" style="background:#4a6fa5"></span><span>Visited</span></div>
          <div class="legend-item"><span class="legend-color" style="background:#28a745"></span><span>Upcoming</span></div>
          <div class="legend-item"><span class="legend-color" style="background:#ffc107"></span><span>Recommended</span></div>
        </div>
      </div>
    </div>
    <div class="chatbot-container">
      <div class="chatbot-header"><i class="fas fa-comments"></i> Travel Assistant</div>
      <div class="quick-actions">
        <button class="quick-action-btn" data-query="monasteries in Sikkim">Monasteries</button>
        <button class="quick-action-btn" data-query="3 day itinerary">3-Day Trip</button>
        <button class="quick-action-btn" data-query="5 day itinerary">5-Day Trip</button>
        <button class="quick-action-btn" data-query="best time to visit">Best Time</button>
        <button class="quick-action-btn" data-query="transportation options">Transportation</button>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="chat-message bot">Hello! I'm your Sikkim travel assistant. Ask me about monasteries, itineraries, or anything about your trip! üèîÔ∏è</div>
      </div>
      <form class="chat-form" id="chat-form">
        <input type="text" class="chat-input" id="chat-input" placeholder="Ask about travel..." />
        <button type="submit" class="chat-send" id="send-btn"><i class="fas fa-paper-plane"></i></button>
      </form>
    </div>
  </div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script>
    // Sidebar toggle
    document.getElementById('menu-toggle').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('show');
    });

    // Chatbot functionality
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');
    const quickActionBtns = document.querySelectorAll('.quick-action-btn');

    // Knowledge base for the chatbot
    const knowledgeBase = {
      // Monastery information
      monasteries: {
        "rumtek monastery": {
          name: "Rumtek Monastery",
          description: "Also known as the Dharmachakra Centre, Rumtek is one of the most important monasteries in Sikkim and the seat of the Karma Kagyu lineage.",
          location: "Near Gangtok",
          highlights: ["Golden Stupa", "Main Shrine Hall", "Monks' quarters", "16th Karmapa's relics"],
          bestTime: "October to March",
          timings: "6:00 AM - 6:00 PM",
          entryFee: "Free (donations accepted)"
        },
        "pemayangtse monastery": {
          name: "Pemayangtse Monastery",
          description: "One of the oldest monasteries in Sikkim, founded in 1705. It belongs to the Nyingma sect of Tibetan Buddhism.",
          location: "Pelling, West Sikkim",
          highlights: ["Zangdogpalri model", "Ancient murals", "Sacred statues"],
          bestTime: "March to May and October to December",
          timings: "9:00 AM - 5:00 PM",
          entryFee: "‚Çπ25 per person"
        },
        "tsuklakhang monastery": {
          name: "Tsuklakhang Monastery",
          description: "The Royal Monastery of Sikkim, located within the Royal Palace complex in Gangtok.",
          location: "Gangtok",
          highlights: ["Royal Chapel", "Peaceful atmosphere", "Traditional architecture"],
          bestTime: "Year-round",
          timings: "7:00 AM - 5:00 PM",
          entryFee: "Free"
        },
        "enchey monastery": {
          name: "Enchey Monastery",
          description: "A 200-year-old monastery belonging to the Nyingma order, known for its annual Chaam dances.",
          location: "Gangtok",
          highlights: ["Chaam dances in January", "Beautiful location", "Ancient scriptures"],
          bestTime: "October to March",
          timings: "6:00 AM - 4:00 PM",
          entryFee: "Free"
        },
        "tashiding monastery": {
          name: "Tashiding Monastery",
          description: "Considered one of the holiest monasteries in Sikkim, founded in 1641.",
          location: "Tashiding, West Sikkim",
          highlights: ["Bhumchu Festival", "Sacred stupas", "Panoramic views"],
          bestTime: "March to May",
          timings: "7:00 AM - 5:00 PM",
          entryFee: "Free (donations accepted)"
        }
      },
      
      // Itineraries
      itineraries: {
        "3 day": {
          title: "3-Day Sikkim Monastery Tour",
          description: "Perfect for a short spiritual getaway focusing on the most significant monasteries.",
          days: [
            {
              day: "Day 1: Gangtok Exploration",
              activities: [
                { time: "9:00 AM", description: "Visit Rumtek Monastery" },
                { time: "1:00 PM", description: "Lunch in Gangtok" },
                { time: "3:00 PM", description: "Explore Enchey Monastery" },
                { time: "5:00 PM", description: "Visit Tsuklakhang Monastery" }
              ]
            },
            {
              day: "Day 2: West Sikkim Journey",
              activities: [
                { time: "7:00 AM", description: "Travel to Pelling" },
                { time: "11:00 AM", description: "Visit Pemayangtse Monastery" },
                { time: "2:00 PM", description: "Lunch in Pelling" },
                { time: "4:00 PM", description: "Explore nearby sights" }
              ]
            },
            {
              day: "Day 3: Return with Tashiding",
              activities: [
                { time: "8:00 AM", description: "Visit Tashiding Monastery" },
                { time: "12:00 PM", description: "Lunch" },
                { time: "2:00 PM", description: "Return to Gangtok" },
                { time: "6:00 PM", description: "Departure" }
              ]
            }
          ]
        },
        "5 day": {
          title: "5-Day Comprehensive Sikkim Experience",
          description: "A more relaxed itinerary covering major monasteries and cultural experiences.",
          days: [
            {
              day: "Day 1: Arrival and Gangtok",
              activities: [
                { time: "12:00 PM", description: "Arrive in Gangtok" },
                { time: "2:00 PM", description: "Check into hotel" },
                { time: "4:00 PM", description: "Visit Enchey Monastery" },
                { time: "7:00 PM", description: "Dinner and local market" }
              ]
            },
            {
              day: "Day 2: Rumtek and Tsuklakhang",
              activities: [
                { time: "9:00 AM", description: "Visit Rumtek Monastery" },
                { time: "1:00 PM", description: "Lunch" },
                { time: "3:00 PM", description: "Explore Tsuklakhang Monastery" },
                { time: "6:00 PM", description: "Cultural show (optional)" }
              ]
            },
            {
              day: "Day 3: Journey to Pelling",
              activities: [
                { time: "8:00 AM", description: "Travel to Pelling" },
                { time: "12:00 PM", description: "Check into hotel and lunch" },
                { time: "2:00 PM", description: "Visit Pemayangtse Monastery" },
                { time: "5:00 PM", description: "Sunset at Pelling viewpoint" }
              ]
            },
            {
              day: "Day 4: Tashiding Monastery",
              activities: [
                { time: "8:00 AM", description: "Travel to Tashiding" },
                { time: "10:00 AM", description: "Visit Tashiding Monastery" },
                { time: "1:00 PM", description: "Lunch" },
                { time: "3:00 PM", description: "Return to Pelling" },
                { time: "7:00 PM", description: "Farewell dinner" }
              ]
            },
            {
              day: "Day 5: Departure",
              activities: [
                { time: "9:00 AM", description: "Breakfast and check out" },
                { time: "11:00 AM", description: "Travel to airport/station" },
                { time: "2:00 PM", description: "Departure" }
              ]
            }
          ]
        }
      },
      
      // General information
      general: {
        "best time to visit": "The best time to visit Sikkim is between March and May or October to mid-December. These periods offer pleasant weather and clear views of the Himalayas.",
        "transportation options": "Sikkim has various transportation options: shared jeeps, private taxis, and buses. For monastery tours, hiring a private vehicle is recommended for flexibility.",
        "permits required": "Indian tourists need an Inner Line Permit (ILP) to visit certain areas of Sikkim, which can be obtained online or at entry points.",
        "accommodation": "Sikkim offers a range of accommodations from budget homestays to luxury hotels. Monastery stays are sometimes available with prior permission.",
        "local cuisine": "Don't miss trying momos, thukpa, gundruk, and traditional Sikkimese tea. Many monasteries serve simple vegetarian meals to visitors."
      }
    };

    // Function to add a message to the chat
    function addMessage(text, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${isUser ? 'user' : 'bot'}`;
      messageDiv.textContent = text;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Function to add an itinerary to the chat
    function addItinerary(itinerary) {
      const itineraryDiv = document.createElement('div');
      itineraryDiv.className = 'itinerary';
      
      let html = `<h4>${itinerary.title}</h4>`;
      html += `<p>${itinerary.description}</p>`;
      
      itinerary.days.forEach(day => {
        html += `<div class="itinerary-day">`;
        html += `<h5>${day.day}</h5>`;
        day.activities.forEach(activity => {
          html += `<div class="itinerary-activity">`;
          html += `<div class="activity-time">${activity.time}</div>`;
          html += `<div class="activity-desc">${activity.description}</div>`;
          html += `</div>`;
        });
        html += `</div>`;
      });
      
      itineraryDiv.innerHTML = html;
      chatMessages.appendChild(itineraryDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Function to process user input and generate response
    function processUserInput(input) {
      const lowerInput = input.toLowerCase();
      
      // Check for monastery queries
      for (const monasteryKey in knowledgeBase.monasteries) {
        if (lowerInput.includes(monasteryKey)) {
          const monastery = knowledgeBase.monasteries[monasteryKey];
          let response = `üèîÔ∏è ${monastery.name}\n\n`;
          response += `${monastery.description}\n\n`;
          response += `üìç Location: ${monastery.location}\n`;
          response += `üïí Timings: ${monastery.timings}\n`;
          response += `üéüÔ∏è Entry Fee: ${monastery.entryFee}\n`;
          response += `üåü Best Time: ${monastery.bestTime}\n\n`;
          response += `Highlights: ${monastery.highlights.join(', ')}`;
          return response;
        }
      }
      
      // Check for itinerary queries
      if (lowerInput.includes('3 day') || lowerInput.includes('three day')) {
        return knowledgeBase.itineraries['3 day'];
      } else if (lowerInput.includes('5 day') || lowerInput.includes('five day')) {
        return knowledgeBase.itineraries['5 day'];
      }
      
      // Check for general queries
      for (const generalKey in knowledgeBase.general) {
        if (lowerInput.includes(generalKey)) {
          return knowledgeBase.general[generalKey];
        }
      }
      
      // Default response for unrecognized queries
      return "I'm not sure about that. You can ask me about monasteries in Sikkim, itineraries, best time to visit, transportation, or permits required. Try using the quick action buttons above!";
    }

    // Event listener for chat form submission
    chatForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = chatInput.value.trim();
      if (!text) return;
      
      addMessage(text, true);
      chatInput.value = '';
      
      // Show typing indicator
      const typingIndicator = document.createElement('div');
      typingIndicator.className = 'chat-message bot';
      typingIndicator.textContent = '...';
      typingIndicator.id = 'typing-indicator';
      chatMessages.appendChild(typingIndicator);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Simulate processing time
      setTimeout(() => {
        document.getElementById('typing-indicator').remove();
        
        const response = processUserInput(text);
        
        if (typeof response === 'object' && response.title) {
          // It's an itinerary object
          addItinerary(response);
        } else {
          // It's a text response
          addMessage(response);
        }
      }, 1500);
    });

    // Event listeners for quick action buttons
    quickActionBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const query = btn.getAttribute('data-query');
        chatInput.value = query;
        chatForm.dispatchEvent(new Event('submit'));
      });
    });

    // Map initialization (unchanged from original)
    mapboxgl.accessToken = 'pk.eyJ1Ijoic2hsb2swMDciLCJhIjoiY21maHlqdXVkMGZjMjJrc2FwZms1NWI4cyJ9.mtav-6CACDNjXmxRGgpitA';
    const sikkimBounds = [[87.9, 27.1], [88.9, 28.2]];
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [88.5122, 27.5330],
      zoom: 8,
      maxBounds: sikkimBounds
    });

    map.on('load', () => {
      document.querySelector('.map-loading').style.display = 'none';
      map.addControl(new mapboxgl.NavigationControl());

      map.addSource('sikkim-boundary', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/geohacker/india/master/state/sikkim.geojson'
      });

      map.addLayer({ id:'sikkim-fill', type:'fill', source:'sikkim-boundary', paint:{'fill-color':'#4a6fa5','fill-opacity':0.15}});
      map.addLayer({ id:'sikkim-outline', type:'line', source:'sikkim-boundary', paint:{'line-color':'#166088','line-width':2}});

      const destinations = [
        { name:'Gangtok', coordinates:[88.6139,27.3389], description:'Capital city with monasteries.', type:'upcoming', date:'Oct 20 - Oct 25, 2025', image:'https://images.unsplash.com/photo-1618839945682-54a2a8a8f6e0?auto=format&fit=crop&w=600&q=80'},
        { name:'Nathula Pass', coordinates:[88.7870,27.3826], description:'Snow-clad Indo-China border.', type:'recommended', date:'Nov 5, 2025', image:'https://images.unsplash.com/photo-1565084886909-ecf7aa0ddc7c?auto=format&fit=crop&w=600&q=80'},
        { name:'Tsomgo Lake', coordinates:[88.7570,27.3748], description:'Glacial lake at 12,000 ft.', type:'visited', date:'March 2025', image:'https://images.unsplash.com/photo-1584945698900-fc8646a1e9b7?auto=format&fit=crop&w=600&q=80'},
        { name:'Yumthang Valley', coordinates:[88.7126,27.7997], description:'Valley of Flowers.', type:'recommended', date:'May 2025', image:'https://images.unsplash.com/photo-1585302219187-3b209d292743?auto=format&fit=crop&w=600&q=80'},
        { name:'Pelling', coordinates:[88.2396,27.3078], description:'Kanchenjunga views.', type:'upcoming', date:'Dec 2025', image:'https://images.unsplash.com/photo-1595254709986-0ff19f1d444b?auto=format&fit=crop&w=600&q=80'},
        { name:'Ravangla', coordinates:[88.3664,27.3089], description:'Famous for Buddha Park.', type:'visited', date:'Jan 2025', image:'https://images.unsplash.com/photo-1631518890101-6b28e0b9230e?auto=format&fit=crop&w=600&q=80'}
      ];

      function getColor(type){ return type==='visited'?'#4a6fa5':type==='upcoming'?'#28a745':'#ffc107'; }
      function getIcon(type){ return type==='visited'?'fa-check-circle':type==='upcoming'?'fa-calendar-check':'fa-star'; }

      destinations.forEach(dest => {
        const el = document.createElement('div');
        el.innerHTML = `<i class="fas ${getIcon(dest.type)}" style="font-size:20px;color:${getColor(dest.type)}"></i>`;
        new mapboxgl.Marker(el)
          .setLngLat(dest.coordinates)
          .setPopup(new mapboxgl.Popup({offset:25}).setHTML(`
            <div style="min-width:230px;">
              <img src="${dest.image}" style="width:100%;height:120px;object-fit:cover;border-radius:8px 8px 0 0;margin-bottom:10px;">
              <h4>${dest.name}</h4>
              <p>${dest.description}</p>
              <p style="font-size:12px;color:#666"><i class="fas fa-calendar-alt"></i> ${dest.date}</p>
            </div>`))
          .addTo(map);
      });
    });

    document.getElementById('zoom-in').onclick=()=>map.zoomIn();
    document.getElementById('zoom-out').onclick=()=>map.zoomOut();
    document.getElementById('reset-view').onclick=()=>map.flyTo({center:[88.5122,27.5330],zoom:8});
  </script>
</body>
</html>
